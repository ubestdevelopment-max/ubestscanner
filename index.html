<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>UBEST Order Scanner - Auto Config</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=IBM+Plex+Mono:wght@400;500;600&family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
/* ... (All your existing CSS styles remain the same) ... */
:root { --bg: #060a12; --s1: #0d1420; --s2: #131d2e; --s3: #1a2640; --border: #1e2d45; --border2: #263850; --cyan: #06d6d6; --cyan2: #04a8a8; --green: #00e676; --red: #ff3d5a; --orange: #ff9800; --blue: #4a9eff; --text: #dde8f5; --muted: #4d6480; --muted2: #7a95b0; --mono: 'IBM Plex Mono', monospace; --head: 'Syne', sans-serif; --body: 'Outfit', sans-serif; }
* { margin:0; padding:0; box-sizing:border-box; }
body { background: var(--bg); color: var(--text); font-family: var(--body); min-height: 100vh; -webkit-font-smoothing: antialiased; }
.wrap { position:relative; z-index:1; max-width:680px; margin:0 auto; padding:20px 16px 100px; }
.topbar { display:flex; align-items:center; justify-content:space-between; padding:16px 20px; background: var(--s1); border: 1px solid var(--border); border-radius:14px; margin-bottom:16px; }
.brand { display:flex; align-items:center; gap:10px; }
.brand-name { font-family:var(--head); font-size:17px; font-weight:800; }
.status-pill { display:flex; align-items:center; gap:6px; padding:6px 12px; border-radius:20px; font-size:11px; font-weight:600; border: 1px solid var(--border); background: var(--s2); color: var(--muted2); }
.status-pill.connected { border-color:var(--green); color:var(--green); }
.card { background: var(--s1); border: 1px solid var(--border); border-radius:14px; padding:20px; margin-bottom:14px; }
.field label { display:block; font-size:11px; font-weight:500; color:var(--muted2); text-transform:uppercase; margin-bottom:5px; font-family:var(--mono); }
.field input, .field select { width:100%; background:var(--s2); border:1px solid var(--border); border-radius:8px; padding:11px 13px; color:var(--text); font-family:var(--mono); font-size:13px; outline:none; }
.scanner-card { background:var(--s1); border:1px solid var(--border); border-radius:14px; padding:20px; margin-bottom:14px; }
.scan-row { display:flex; gap:10px; align-items:flex-end; }
.add-btn { height:50px; padding:0 18px; background:var(--cyan); border:none; border-radius:8px; color:var(--bg); font-weight:700; cursor:pointer; }
.item-list { display:flex; flex-direction:column; gap:7px; margin-bottom:14px; }
.item { display:flex; align-items:center; gap:10px; background:var(--s2); border:1px solid var(--border); border-radius:10px; padding:11px 14px; }
.item-bar { font-family:var(--mono); font-size:13px; color:var(--cyan); flex:1; }
.submit-btn { width:100%; height:56px; background:var(--cyan); border:none; border-radius:10px; color:var(--bg); font-weight:800; cursor:pointer; }
.submit-btn:disabled { opacity:0.3; }
</style>
</head>
<body>

<div class="wrap">
  <div class="topbar">
    <div class="brand">
      <div class="brand-logo">ðŸ“¦</div>
      <div>
        <div class="brand-name">UBEST SCANNER</div>
        <div class="brand-sub">AUTO-CONNECTED</div>
      </div>
    </div>
    <div class="status-pill connected" id="statusPill">
      <span class="status-dot"></span>
      <span id="statusText">CONNECTED</span>
    </div>
  </div>

  <div class="card">
    <div class="field">
      <label>Branch</label>
      <select id="branchSel">
        <option value="Main Warehouse">Main Warehouse</option>
        <option value="Branch A">Branch A</option>
      </select>
    </div>
    <div class="field">
      <label>Supplier</label>
      <input type="text" id="supplierIn" placeholder="Enter Supplier Name" style="width:100%; background:var(--s2); border:1px solid var(--border); border-radius:8px; padding:11px 13px; color:var(--text); font-family:var(--mono); font-size:13px;">
    </div>
  </div>

  <div class="scanner-card">
    <div class="scan-row">
      <div style="flex:1">
        <div class="field">
          <label>Scan Barcode</label>
          <input type="text" id="barcodeIn" placeholder="Scan here..." autofocus />
        </div>
      </div>
      <button class="add-btn" onclick="addItem()">ï¼‹ Add</button>
    </div>
  </div>

  <div class="item-list" id="itemList"></div>

  <button class="submit-btn" id="submitBtn" onclick="submitAll()" disabled>ðŸš€ Submit to Lark Base</button>
</div>

<script>
// AUTO-CONFIGURED CONSTANTS
const APP_ID = "cli_a92bb5e5aea25e19";
const APP_SECRET = "PjRUNkJoakbhvyLsDGUnddLhSB6Bc5KH";
const APP_TOKEN = "ACLcblLjYa3flwswnRDjRos6pUc";
const TABLE_ID = "tblrFRw4I8rq9vit";

let items = [];

// ADD ITEM LOGIC
function addItem() {
  const input = document.getElementById('barcodeIn');
  const code = input.value.trim();
  if (!code) return;

  const existing = items.find(i => i.barcode === code);
  if (existing) {
    existing.qty++;
  } else {
    items.push({ barcode: code, qty: 1 });
  }
  
  input.value = '';
  input.focus();
  render();
}

// RENDER LIST
function render() {
  const list = document.getElementById('itemList');
  const btn = document.getElementById('submitBtn');
  btn.disabled = items.length === 0;
  
  list.innerHTML = items.map(it => `
    <div class="item">
      <span class="item-bar">${it.barcode}</span>
      <span style="font-weight:bold">x${it.qty}</span>
    </div>
  `).join('');
}

// SUBMIT TO LARK
async function submitAll() {
  const btn = document.getElementById('submitBtn');
  btn.innerText = "Sending...";
  btn.disabled = true;

  try {
    // 1. Get Token via Proxy
    const authUrl = 'https://corsproxy.io/?' + encodeURIComponent('https://open.larksuite.com/open-apis/auth/v3/tenant_access_token/internal');
    const authRes = await fetch(authUrl, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ app_id: APP_ID, app_secret: APP_SECRET })
    });
    const authData = await authRes.json();
    const token = authData.tenant_access_token;

    // 2. Prepare Records
    const records = items.map(it => ({
      fields: {
        "Barcode": it.barcode,
        "Quantity": it.qty,
        "Branch": document.getElementById('branchSel').value,
        "Supplier": document.getElementById('supplierIn').value
      }
    }));

    // 3. Batch Create via Proxy
    const apiTarget = `https://open.larksuite.com/open-apis/bitable/v1/apps/${APP_TOKEN}/tables/${TABLE_ID}/records/batch_create`;
    const apiUrl = 'https://corsproxy.io/?' + encodeURIComponent(apiTarget);

    const res = await fetch(apiUrl, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ records })
    });

    const data = await res.json();
    if (data.code === 0) {
      alert("âœ… Order Submitted Successfully!");
      items = [];
      render();
    } else {
      alert("âŒ Error: " + data.msg);
    }
  } catch (e) {
    alert("Connection Error. Check your Lark permissions.");
  } finally {
    btn.innerText = "ðŸš€ Submit to Lark Base";
  }
}

// Support Enter Key
document.getElementById('barcodeIn').addEventListener('keypress', (e) => {
  if (e.key === 'Enter') addItem();
});
</script>
</body>
</html>
