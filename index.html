<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>UBEST Order Scanner</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=IBM+Plex+Mono:wght@400;500;600&family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root {
Â  --bg: #060a12;
Â  --s1: #0d1420;
Â  --s2: #131d2e;
Â  --s3: #1a2640;
Â  --border: #1e2d45;
Â  --border2: #263850;
Â  --cyan: #06d6d6;
Â  --cyan2: #04a8a8;
Â  --green: #00e676;
Â  --red: #ff3d5a;
Â  --orange: #ff9800;
Â  --blue: #4a9eff;
Â  --text: #dde8f5;
Â  --muted: #4d6480;
Â  --muted2: #7a95b0;
Â  --mono: 'IBM Plex Mono', monospace;
Â  --head: 'Syne', sans-serif;
Â  --body: 'Outfit', sans-serif;
}
* { margin:0; padding:0; box-sizing:border-box; }
html { scroll-behavior: smooth; }
body {
Â  background: var(--bg);
Â  color: var(--text);
Â  font-family: var(--body);
Â  min-height: 100vh;
Â  -webkit-font-smoothing: antialiased;
}

/* Grid bg */
body::before {
Â  content:'';
Â  position:fixed; inset:0;
Â  background-image:
Â  Â  linear-gradient(rgba(6,214,214,0.03) 1px, transparent 1px),
Â  Â  linear-gradient(90deg, rgba(6,214,214,0.03) 1px, transparent 1px);
Â  background-size: 40px 40px;
Â  pointer-events:none; z-index:0;
}
body::after {
Â  content:'';
Â  position:fixed;
Â  top:-300px; right:-300px;
Â  width:800px; height:800px;
Â  background: radial-gradient(circle, rgba(6,214,214,0.04) 0%, transparent 65%);
Â  pointer-events:none; z-index:0;
}

.wrap {
Â  position:relative; z-index:1;
Â  max-width:680px;
Â  margin:0 auto;
Â  padding:20px 16px 100px;
}

/* â”€â”€ TOP BAR â”€â”€ */
.topbar {
Â  display:flex; align-items:center; justify-content:space-between;
Â  padding:16px 20px;
Â  background: var(--s1);
Â  border: 1px solid var(--border);
Â  border-radius:14px;
Â  margin-bottom:16px;
}
.brand { display:flex; align-items:center; gap:10px; }
.brand-logo {
Â  width:38px; height:38px;
Â  background: linear-gradient(135deg, var(--cyan), #0a9f9f);
Â  border-radius:9px;
Â  display:flex; align-items:center; justify-content:center;
Â  font-size:18px;
}
.brand-name {
Â  font-family:var(--head);
Â  font-size:17px; font-weight:800;
Â  letter-spacing:0.5px;
}
.brand-sub { font-size:11px; color:var(--muted); margin-top:1px; font-family:var(--mono); }
.status-pill {
Â  display:flex; align-items:center; gap:6px;
Â  padding:6px 12px;
Â  border-radius:20px;
Â  font-size:11px; font-weight:600;
Â  font-family:var(--mono);
Â  letter-spacing:0.5px;
Â  border: 1px solid var(--border);
Â  background: var(--s2);
Â  color: var(--muted2);
Â  transition: all 0.3s;
}
.status-pill.connected { border-color:var(--green); color:var(--green); background:rgba(0,230,118,0.07); }
.status-pill.error { border-color:var(--red); color:var(--red); background:rgba(255,61,90,0.07); }
.status-dot { width:7px; height:7px; border-radius:50%; background:currentColor; }
.status-pill.connected .status-dot { animation: pulse 1.5s infinite; }
@keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.3} }

/* â”€â”€ CARDS â”€â”€ */
.card {
Â  background: var(--s1);
Â  border: 1px solid var(--border);
Â  border-radius:14px;
Â  padding:20px;
Â  margin-bottom:14px;
}
.card-title {
Â  font-family:var(--mono);
Â  font-size:10px; font-weight:600;
Â  text-transform:uppercase; letter-spacing:1.5px;
Â  color:var(--muted);
Â  margin-bottom:14px;
Â  display:flex; align-items:center; gap:8px;
}
.card-title::before {
Â  content:'';
Â  width:3px; height:12px;
Â  background:var(--cyan);
Â  border-radius:2px;
Â  display:block;
}

/* â”€â”€ INPUTS â”€â”€ */
.field { margin-bottom:12px; }
.field:last-child { margin-bottom:0; }
.field label {
Â  display:block;
Â  font-size:11px; font-weight:500;
Â  color:var(--muted2);
Â  text-transform:uppercase; letter-spacing:0.6px;
Â  margin-bottom:5px;
Â  font-family:var(--mono);
}
.field input, .field select {
Â  width:100%;
Â  background:var(--s2);
Â  border:1px solid var(--border);
Â  border-radius:8px;
Â  padding:11px 13px;
Â  color:var(--text);
Â  font-family:var(--mono);
Â  font-size:13px;
Â  outline:none;
Â  transition: border-color 0.2s, box-shadow 0.2s;
Â  -webkit-appearance: none;
}
.field input:focus, .field select:focus {
Â  border-color:var(--cyan);
Â  box-shadow:0 0 0 3px rgba(6,214,214,0.08);
}
.field select option { background:var(--s1); }
.grid2 { display:grid; grid-template-columns:1fr 1fr; gap:12px; }

/* â”€â”€ CONNECT BTN â”€â”€ */
.connect-btn {
Â  width:100%; padding:13px;
Â  background:linear-gradient(135deg, var(--cyan), #059f9f);
Â  border:none; border-radius:9px;
Â  color:var(--bg);
Â  font-family:var(--head);
Â  font-size:14px; font-weight:700;
Â  cursor:pointer;
Â  letter-spacing:0.5px;
Â  transition:all 0.2s;
Â  display:flex; align-items:center; justify-content:center; gap:8px;
Â  margin-top:4px;
}
.connect-btn:hover { transform:translateY(-1px); box-shadow:0 6px 20px rgba(6,214,214,0.25); }
.connect-btn:active { transform:translateY(0); }
.connect-btn:disabled { opacity:0.5; cursor:not-allowed; transform:none; box-shadow:none; }

/* â”€â”€ SESSION ROW â”€â”€ */
.session-row { display:grid; grid-template-columns:1fr 1fr; gap:12px; }

/* â”€â”€ SCANNER â”€â”€ */
.scanner-card {
Â  background:var(--s1);
Â  border:1px solid var(--border);
Â  border-radius:14px;
Â  padding:20px;
Â  margin-bottom:14px;
Â  position:relative;
Â  overflow:hidden;
Â  transition:border-color 0.3s;
}
.scanner-card.scanning { border-color:var(--cyan); }
.scanner-card.scanning::after {
Â  content:'';
Â  position:absolute;
Â  top:0; left:0; right:0;
Â  height:2px;
Â  background:linear-gradient(90deg, transparent, var(--cyan), transparent);
Â  animation:shimmer 1.5s infinite;
}
@keyframes shimmer {
Â  0% { opacity:0.3; transform:scaleX(0.3); }
Â  50% { opacity:1; transform:scaleX(1); }
Â  100% { opacity:0.3; transform:scaleX(0.3); }
}

.scan-row {
Â  display:flex; gap:10px; align-items:flex-end;
}
.scan-barcode-wrap { flex:1; }
.scan-qty-wrap { width:88px; flex-shrink:0; }
.barcode-in {
Â  font-size:15px !important;
Â  padding:14px 14px !important;
Â  background:var(--bg) !important;
Â  border-color:var(--cyan) !important;
Â  letter-spacing:1px;
}
.barcode-in::placeholder { color:var(--muted); font-size:12px; letter-spacing:0; }
.qty-in { text-align:center; font-size:16px !important; height:50px; }

.add-btn {
Â  height:50px; padding:0 18px;
Â  background:var(--cyan);
Â  border:none; border-radius:8px;
Â  color:var(--bg);
Â  font-family:var(--head);
Â  font-size:14px; font-weight:700;
Â  cursor:pointer;
Â  white-space:nowrap; flex-shrink:0;
Â  transition:all 0.15s;
}
.add-btn:hover { background:#08f0f0; transform:translateY(-1px); }
.add-btn:active { transform:translateY(0); }

.hint-row {
Â  display:flex; align-items:center; gap:8px;
Â  margin-top:10px;
Â  font-size:11px; color:var(--muted2);
Â  font-family:var(--mono);
}
.hint-dot { width:6px; height:6px; border-radius:50%; background:var(--green); animation:pulse 1.5s infinite; }

/* Camera */
.cam-section { display:none; margin-top:14px; }
.cam-section.show { display:block; }
#vid-wrap {
Â  border-radius:10px; overflow:hidden;
Â  background:#000; aspect-ratio:16/9; position:relative;
}
#vid { width:100%; height:100%; object-fit:cover; display:block; }
.cam-overlay {
Â  position:absolute; inset:0;
Â  display:flex; align-items:center; justify-content:center;
Â  pointer-events:none;
}
.cam-frame {
Â  width:55%; max-width:220px; height:100px;
Â  border:2px solid var(--cyan); border-radius:8px;
Â  position:relative;
Â  box-shadow:0 0 0 9999px rgba(0,0,0,0.45);
}
.cam-beam {
Â  position:absolute;
Â  top:0; left:0; right:0;
Â  height:2px; background:var(--cyan);
Â  box-shadow:0 0 8px var(--cyan);
Â  animation:beam 1.8s ease-in-out infinite;
}
@keyframes beam { 0%{top:0} 100%{top:calc(100% - 2px)} }
.cam-close {
Â  width:100%; margin-top:8px;
Â  padding:9px;
Â  background:transparent;
Â  border:1px solid var(--border);
Â  border-radius:8px;
Â  color:var(--muted2); font-size:12px;
Â  cursor:pointer;
Â  transition:all 0.2s;
}
.cam-close:hover { border-color:var(--red); color:var(--red); }
.cam-open-btn {
Â  width:100%; margin-top:12px;
Â  padding:9px;
Â  background:transparent;
Â  border:1px solid var(--border);
Â  border-radius:8px;
Â  color:var(--muted2); font-size:12px;
Â  cursor:pointer;
Â  transition:all 0.2s;
}
.cam-open-btn:hover { border-color:var(--cyan); color:var(--cyan); }

/* â”€â”€ LIST HEADER â”€â”€ */
.list-header {
Â  display:flex; justify-content:space-between; align-items:center;
Â  margin-bottom:10px;
}
.list-title {
Â  font-family:var(--mono);
Â  font-size:10px; font-weight:600;
Â  text-transform:uppercase; letter-spacing:1.5px;
Â  color:var(--muted);
Â  display:flex; align-items:center; gap:8px;
}
.list-title::before {
Â  content:''; width:3px; height:12px;
Â  background:var(--cyan); border-radius:2px;
}
.count-badge {
Â  background:rgba(6,214,214,0.12);
Â  border:1px solid rgba(6,214,214,0.3);
Â  color:var(--cyan);
Â  font-family:var(--mono); font-size:11px; font-weight:600;
Â  padding:2px 9px; border-radius:20px;
}

/* â”€â”€ EMPTY â”€â”€ */
.empty {
Â  background:var(--s1); border:1px dashed var(--border2);
Â  border-radius:14px; padding:52px 20px;
Â  text-align:center; margin-bottom:14px;
}
.empty-icon { font-size:42px; display:block; margin-bottom:12px; opacity:0.35; }
.empty-txt { color:var(--muted2); font-size:14px; }
.empty-sub { color:var(--muted); font-size:12px; margin-top:5px; }

/* â”€â”€ ITEM LIST â”€â”€ */
.item-list {
Â  display:flex; flex-direction:column; gap:7px;
Â  max-height:400px; overflow-y:auto;
Â  padding-right:4px; margin-bottom:14px;
Â  display:none;
}
.item-list::-webkit-scrollbar { width:3px; }
.item-list::-webkit-scrollbar-track { background:transparent; }
.item-list::-webkit-scrollbar-thumb { background:var(--border2); border-radius:2px; }

.item {
Â  display:flex; align-items:center; gap:10px;
Â  background:var(--s2); border:1px solid var(--border);
Â  border-radius:10px; padding:11px 14px;
Â  animation:slideIn 0.18s ease;
Â  transition:border-color 0.2s;
}
.item:hover { border-color:var(--border2); }
@keyframes slideIn { from{opacity:0;transform:translateY(-6px)} to{opacity:1;transform:translateY(0)} }
.item.merged { border-color:var(--blue); }

.item-num { font-family:var(--mono); font-size:10px; color:var(--muted); width:18px; text-align:right; flex-shrink:0; }
.item-bar { font-family:var(--mono); font-size:13px; font-weight:600; color:var(--cyan); flex:1; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
.merged-tag {
Â  font-size:9px; font-family:var(--mono);
Â  background:rgba(74,158,255,0.12); border:1px solid rgba(74,158,255,0.3);
Â  color:var(--blue); padding:1px 6px; border-radius:4px;
Â  flex-shrink:0;
}
.qty-ctrl { display:flex; align-items:center; gap:5px; flex-shrink:0; }
.qb {
Â  width:24px; height:24px;
Â  background:var(--s1); border:1px solid var(--border);
Â  border-radius:5px; color:var(--text);
Â  font-size:14px; line-height:1;
Â  cursor:pointer; display:flex; align-items:center; justify-content:center;
Â  transition:all 0.15s;
}
.qb:hover { border-color:var(--cyan); color:var(--cyan); }
.item-qty { font-family:var(--mono); font-size:13px; font-weight:700; min-width:26px; text-align:center; }
.del-btn {
Â  width:27px; height:27px;
Â  background:transparent; border:1px solid transparent;
Â  border-radius:6px; color:var(--muted);
Â  font-size:13px; cursor:pointer;
Â  display:flex; align-items:center; justify-content:center;
Â  transition:all 0.15s; flex-shrink:0;
}
.del-btn:hover { border-color:var(--red); color:var(--red); background:rgba(255,61,90,0.08); }

/* â”€â”€ SUMMARY â”€â”€ */
.summary {
Â  display:none; gap:0;
Â  background:var(--s1); border:1px solid var(--border);
Â  border-radius:12px; overflow:hidden;
Â  margin-bottom:14px;
}
.sum-stat { flex:1; padding:14px 10px; text-align:center; position:relative; }
.sum-stat+.sum-stat::before {
Â  content:''; position:absolute;
Â  left:0; top:20%; bottom:20%;
Â  width:1px; background:var(--border);
}
.sum-val { font-family:var(--mono); font-size:24px; font-weight:700; color:var(--cyan); line-height:1; }
.sum-lbl { font-size:10px; color:var(--muted); text-transform:uppercase; letter-spacing:0.8px; margin-top:4px; font-family:var(--mono); }

/* â”€â”€ BOTTOM ACTIONS â”€â”€ */
.actions { display:flex; gap:10px; }
.clear-btn {
Â  padding:0 18px; height:56px;
Â  background:transparent; border:1px solid var(--border);
Â  border-radius:10px; color:var(--muted2);
Â  font-size:13px; cursor:pointer;
Â  transition:all 0.2s; white-space:nowrap;
}
.clear-btn:hover { border-color:var(--red); color:var(--red); }
.submit-btn {
Â  flex:1; height:56px;
Â  background:linear-gradient(135deg, #059f9f 0%, var(--cyan) 50%, #06d680 100%);
Â  background-size:200% 100%;
Â  background-position:0% 0%;
Â  border:none; border-radius:10px;
Â  color:var(--bg);
Â  font-family:var(--head);
Â  font-size:16px; font-weight:800;
Â  cursor:pointer; letter-spacing:0.5px;
Â  transition:all 0.3s;
Â  position:relative; overflow:hidden;
Â  display:flex; align-items:center; justify-content:center; gap:8px;
}
.submit-btn:hover:not(:disabled) {
Â  background-position:100% 0%;
Â  transform:translateY(-2px);
Â  box-shadow:0 8px 28px rgba(6,214,214,0.3);
}
.submit-btn:active:not(:disabled) { transform:translateY(0); }
.submit-btn:disabled { opacity:0.3; cursor:not-allowed; }
.spin {
Â  display:none; width:18px; height:18px;
Â  border:2px solid rgba(0,0,0,0.2);
Â  border-top-color:var(--bg);
Â  border-radius:50%;
Â  animation:spin 0.65s linear infinite;
}
@keyframes spin { to{transform:rotate(360deg)} }
.submit-btn.loading .btn-label { display:none; }
.submit-btn.loading .spin { display:block; }
.submit-btn.loading { cursor:not-allowed; }

/* â”€â”€ TOAST â”€â”€ */
.toasts {
Â  position:fixed; bottom:20px; left:50%;
Â  transform:translateX(-50%);
Â  z-index:999; display:flex; flex-direction:column; gap:8px; align-items:center;
Â  pointer-events:none;
}
.toast {
Â  padding:11px 18px; border-radius:9px;
Â  font-size:13px; font-weight:500;
Â  font-family:var(--body);
Â  animation:toastPop 0.25s ease forwards;
Â  max-width:340px; text-align:center;
Â  backdrop-filter:blur(12px);
Â  pointer-events:all;
}
.toast.okÂ  { background:rgba(0,230,118,0.1); border:1px solid var(--green); color:var(--green); }
.toast.err { background:rgba(255,61,90,0.1); border:1px solid var(--red); color:var(--red); }
.toast.inf { background:rgba(6,214,214,0.08); border:1px solid rgba(6,214,214,0.4); color:var(--cyan); }
.toast.wrn { background:rgba(255,152,0,0.1); border:1px solid var(--orange); color:var(--orange); }
@keyframes toastPop { from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:translateY(0)} }

/* â”€â”€ SETUP OVERLAY â”€â”€ */
.overlay {
Â  display:none;
Â  position:fixed; inset:0; z-index:100;
Â  background:rgba(6,10,18,0.85);
Â  backdrop-filter:blur(8px);
Â  align-items:center; justify-content:center;
Â  padding:20px;
}
.overlay.show { display:flex; }
.modal {
Â  background:var(--s1); border:1px solid var(--border2);
Â  border-radius:18px; padding:28px; width:100%; max-width:520px;
Â  animation:modalIn 0.25s ease;
}
@keyframes modalIn { from{opacity:0;transform:scale(0.95)} to{opacity:1;transform:scale(1)} }
.modal h2 {
Â  font-family:var(--head); font-size:20px; font-weight:800;
Â  margin-bottom:6px;
}
.modal p { font-size:13px; color:var(--muted2); margin-bottom:20px; line-height:1.6; }
.modal-grid { display:grid; gap:12px; }
.modal-grid .g2 { grid-template-columns:1fr 1fr; display:grid; gap:12px; }

/* Connection status banner */
.conn-banner {
Â  display:none; padding:10px 16px;
Â  border-radius:9px; font-size:13px;
Â  margin-top:12px;
Â  font-family:var(--mono);
}
.conn-banner.ok { background:rgba(0,230,118,0.08); border:1px solid var(--green); color:var(--green); display:block; }
.conn-banner.err { background:rgba(255,61,90,0.08); border:1px solid var(--red); color:var(--red); display:block; }

/* â”€â”€ RESPONSIVE â”€â”€ */
@media(max-width:480px) {
Â  .grid2 { grid-template-columns:1fr; }
Â  .session-row { grid-template-columns:1fr; }
}
</style>
</head>
<body>

<!-- Setup Overlay -->
<div class="overlay show" id="setupOverlay">
Â  <div class="modal">
Â  Â  <h2>ğŸ”§ Connect to Lark Base</h2>
Â  Â  <p>Enter your Lark Base details to connect the scanner. Your credentials are saved locally in your browser.</p>
Â  Â  <div class="modal-grid">
Â  Â  Â  <div class="g2">
Â  Â  Â  Â  <div class="field">
Â  Â  Â  Â  Â  <label>App ID</label>
Â  Â  Â  Â  Â  <input id="s_appId" type="text" placeholder="cli_xxxxxxxx" value="cli_a92bb5e5aea25e19" />
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="field">
Â  Â  Â  Â  Â  <label>App Secret</label>
Â  Â  Â  Â  Â  <input id="s_appSecret" type="password" placeholder="Your App Secret" value="PjRUNkJoakbhvyLsDGUnddLhSB6Bc5KH" />
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â  <div class="field">
Â  Â  Â  Â  <label>App Token (from Base URL)</label>
Â  Â  Â  Â  <input id="s_appToken" type="text" placeholder="bascnXXXXXXXXXXXX" />
Â  Â  Â  </div>
Â  Â  Â  <div class="field">
Â  Â  Â  Â  <label>Table ID</label>
Â  Â  Â  Â  <input id="s_tableId" type="text" placeholder="tblXXXXXXXXXXXX" />
Â  Â  Â  </div>
Â  Â  Â  <div class="g2">
Â  Â  Â  Â  <div class="field">
Â  Â  Â  Â  Â  <label>Barcode Field</label>
Â  Â  Â  Â  Â  <input id="s_barcodeF" type="text" value="Barcode" />
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="field">
Â  Â  Â  Â  Â  <label>Quantity Field</label>
Â  Â  Â  Â  Â  <input id="s_qtyF" type="text" value="Quantity" />
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="field">
Â  Â  Â  Â  Â  <label>Branch Field</label>
Â  Â  Â  Â  Â  <input id="s_branchF" type="text" value="Branch" />
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="field">
Â  Â  Â  Â  Â  <label>Supplier Field</label>
Â  Â  Â  Â  Â  <input id="s_supplierF" type="text" value="Supplier" />
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â  <div id="setupBanner" class="conn-banner"></div>
Â  Â  Â  <button class="connect-btn" id="connectBtn" onclick="connectLark()">
Â  Â  Â  Â  <span id="connectLabel">âš¡ Connect &amp; Start Scanning</span>
Â  Â  Â  Â  <span class="spin" id="connectSpin"></span>
Â  Â  Â  </button>
Â  Â  </div>
Â  </div>
</div>

<!-- Main App -->
<div class="wrap">

Â  <!-- Top Bar -->
Â  <div class="topbar">
Â  Â  <div class="brand">
Â  Â  Â  <div class="brand-logo">ğŸ“¦</div>
Â  Â  Â  <div>
Â  Â  Â  Â  <div class="brand-name">UBEST SCANNER</div>
Â  Â  Â  Â  <div class="brand-sub">BATCH ORDER ENTRY</div>
Â  Â  Â  </div>
Â  Â  </div>
Â  Â  <div class="status-pill" id="statusPill">
Â  Â  Â  <span class="status-dot"></span>
Â  Â  Â  <span id="statusText">NOT CONNECTED</span>
Â  Â  </div>
Â  </div>

Â  <!-- Session -->
Â  <div class="card">
Â  Â  <div class="card-title">Session Info</div>
Â  Â  <div class="session-row">
Â  Â  Â  <div class="field">
Â  Â  Â  Â  <label>Branch</label>
Â  Â  Â  Â  <select id="branchSel">
Â  Â  Â  Â  Â  <option value="">â€” Select Branch â€”</option>
Â  Â  Â  Â  </select>
Â  Â  Â  </div>
Â  Â  Â  <div class="field">
Â  Â  Â  Â  <label>Supplier</label>
Â  Â  Â  Â  <select id="supplierSel">
Â  Â  Â  Â  Â  <option value="">â€” Select Supplier â€”</option>
Â  Â  Â  Â  </select>
Â  Â  Â  </div>
Â  Â  </div>
Â  Â  <div style="text-align:right; margin-top:8px;">
Â  Â  Â  <button onclick="showSetup()" style="background:transparent;border:none;color:var(--muted2);font-size:12px;cursor:pointer;text-decoration:underline;font-family:var(--mono);">âš™ Change Connection</button>
Â  Â  </div>
Â  </div>

Â  <!-- Scanner -->
Â  <div class="scanner-card" id="scanCard">
Â  Â  <div class="card-title">Barcode Scanner</div>
Â  Â  <div class="scan-row">
Â  Â  Â  <div class="scan-barcode-wrap">
Â  Â  Â  Â  <div class="field" style="margin:0">
Â  Â  Â  Â  Â  <label>Barcode / QR Code</label>
Â  Â  Â  Â  Â  <input type="text" id="barcodeIn" class="field input barcode-in"
Â  Â  Â  Â  Â  Â  placeholder="Scan or type here..."
Â  Â  Â  Â  Â  Â  autocomplete="off" autocorrect="off" spellcheck="false" />
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â  <div class="scan-qty-wrap">
Â  Â  Â  Â  <div class="field" style="margin:0">
Â  Â  Â  Â  Â  <label>Qty</label>
Â  Â  Â  Â  Â  <input type="number" id="qtyIn" value="1" min="1" class="qty-in" style="background:var(--s2);border:1px solid var(--border);border-radius:8px;padding:11px 13px;color:var(--text);font-family:var(--mono);font-size:16px;outline:none;width:100%;height:50px;text-align:center;" />
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â  <button class="add-btn" onclick="addItem()">ï¼‹ Add</button>
Â  Â  </div>
Â  Â  <div class="hint-row">
Â  Â  Â  <span class="hint-dot"></span>
Â  Â  Â  Press Enter or click Add after each scan â€” duplicates merge automatically
Â  Â  </div>

Â  Â  <!-- Camera -->
Â  Â  <div class="cam-section" id="camSection">
Â  Â  Â  <div id="vid-wrap">
Â  Â  Â  Â  <video id="vid" autoplay muted playsinline></video>
Â  Â  Â  Â  <div class="cam-overlay"><div class="cam-frame"><div class="cam-beam"></div></div></div>
Â  Â  Â  </div>
Â  Â  Â  <button class="cam-close" onclick="stopCam()">âœ• Close Camera</button>
Â  Â  </div>
Â  Â  <button class="cam-open-btn" id="camOpenBtn" onclick="openCam()">ğŸ“· Use Camera / Auto Scan</button>
Â  </div>

Â  <!-- List Header -->
Â  <div class="list-header">
Â  Â  <div class="list-title">Scanned Items</div>
Â  Â  <div class="count-badge" id="countBadge">0 items</div>
Â  </div>

Â  <!-- Empty State -->
Â  <div class="empty" id="emptyState">
Â  Â  <span class="empty-icon">ğŸ”²</span>
Â  Â  <div class="empty-txt">No items scanned yet</div>
Â  Â  <div class="empty-sub">Start scanning barcodes above â€” they'll appear here</div>
Â  </div>

Â  <!-- Item List -->
Â  <div class="item-list" id="itemList"></div>

Â  <!-- Summary -->
Â  <div class="summary" id="summary" style="display:none;">
Â  Â  <div class="sum-stat" style="display:flex;flex-direction:column;align-items:center;justify-content:center;">
Â  Â  Â  <div class="sum-val" id="sumItems">0</div>
Â  Â  Â  <div class="sum-lbl">Rows</div>
Â  Â  </div>
Â  Â  <div class="sum-stat" style="display:flex;flex-direction:column;align-items:center;justify-content:center;">
Â  Â  Â  <div class="sum-val" id="sumQty">0</div>
Â  Â  Â  <div class="sum-lbl">Total Qty</div>
Â  Â  </div>
Â  Â  <div class="sum-stat" style="display:flex;flex-direction:column;align-items:center;justify-content:center;">
Â  Â  Â  <div class="sum-val" id="sumUniq">0</div>
Â  Â  Â  <div class="sum-lbl">Unique SKUs</div>
Â  Â  </div>
Â  </div>

Â  <!-- Actions -->
Â  <div class="actions">
Â  Â  <button class="clear-btn" onclick="clearAll()">ğŸ—‘ Clear</button>
Â  Â  <button class="submit-btn" id="submitBtn" onclick="submitAll()" disabled>
Â  Â  Â  <span class="btn-label">ğŸš€ Submit All to Lark Base</span>
Â  Â  Â  <span class="spin"></span>
Â  Â  </button>
Â  </div>

</div>

<div class="toasts" id="toasts"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//Â  STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let items = [];
let cfg = {
Â  appId: 'cli_a92bb5e5aea25e19',
Â  appSecret: 'PjRUNkJoakbhvyLsDGUnddLhSB6Bc5KH',
Â  appToken: '',
Â  tableId: '',
Â  barcodeF: 'Barcode',
Â  qtyF: 'Quantity',
Â  branchF: 'Branch',
Â  supplierF: 'Supplier'
};
let token = null;
let tokenExp = 0;
let camStream = null;
let camTimer = null;

// Branch & Supplier options â€” edit these to match your actual data
const BRANCHESÂ  = ['Main Branch','North Branch','South Branch','Warehouse','Online'];
const SUPPLIERS = ['Supplier A','Supplier B','Supplier C','Supplier D'];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//Â  INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.addEventListener('DOMContentLoaded', () => {
Â  loadCfg();
Â  populateSelects();
Â  render();

Â  document.getElementById('barcodeIn').addEventListener('keydown', e => {
Â  Â  if (e.key === 'Enter') { e.preventDefault(); addItem(); }
Â  });

Â  // If already configured, skip setup
Â  if (cfg.appToken && cfg.tableId) {
Â  Â  document.getElementById('setupOverlay').classList.remove('show');
Â  Â  setStatus('connected', 'CONNECTED');
Â  }
});

function populateSelects() {
Â  const bs = document.getElementById('branchSel');
Â  const ss = document.getElementById('supplierSel');
Â  BRANCHES.forEach(b => {
Â  Â  const o = document.createElement('option'); o.value = b; o.textContent = b; bs.appendChild(o);
Â  });
Â  SUPPLIERS.forEach(s => {
Â  Â  const o = document.createElement('option'); o.value = s; o.textContent = s; ss.appendChild(o);
Â  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//Â  CONFIG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function loadCfg() {
Â  const s = localStorage.getItem('ubest_cfg');
Â  if (s) {
Â  Â  const saved = JSON.parse(s);
Â  Â  cfg = { ...cfg, ...saved };
Â  }
Â  // Pre-fill modal
Â  document.getElementById('s_appId').valueÂ  Â  Â  = cfg.appId;
Â  document.getElementById('s_appSecret').valueÂ  = cfg.appSecret;
Â  document.getElementById('s_appToken').valueÂ  Â = cfg.appToken;
Â  document.getElementById('s_tableId').valueÂ  Â  = cfg.tableId;
Â  document.getElementById('s_barcodeF').valueÂ  Â = cfg.barcodeF;
Â  document.getElementById('s_qtyF').valueÂ  Â  Â  Â = cfg.qtyF;
Â  document.getElementById('s_branchF').valueÂ  Â  = cfg.branchF;
Â  document.getElementById('s_supplierF').valueÂ  = cfg.supplierF;
}

function saveCfg() {
Â  cfg.appIdÂ  Â  Â = document.getElementById('s_appId').value.trim();
Â  cfg.appSecret = document.getElementById('s_appSecret').value.trim();
Â  cfg.appTokenÂ  = document.getElementById('s_appToken').value.trim();
Â  cfg.tableIdÂ  Â = document.getElementById('s_tableId').value.trim();
Â  cfg.barcodeFÂ  = document.getElementById('s_barcodeF').value.trim() || 'Barcode';
Â  cfg.qtyFÂ  Â  Â  = document.getElementById('s_qtyF').value.trim()Â  Â  Â || 'Quantity';
Â  cfg.branchFÂ  Â = document.getElementById('s_branchF').value.trim()Â  || 'Branch';
Â  cfg.supplierF = document.getElementById('s_supplierF').value.trim()|| 'Supplier';
Â  localStorage.setItem('ubest_cfg', JSON.stringify(cfg));
}

function showSetup() {
Â  loadCfg();
Â  document.getElementById('setupBanner').className = 'conn-banner';
Â  document.getElementById('setupBanner').textContent = '';
Â  document.getElementById('setupOverlay').classList.add('show');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//Â  LARK AUTH â€” Tenant Access Token
//Â  NOTE: Lark's auth endpoint blocks CORS.
//Â  Two options built in:
//Â  Â 1. Direct (works if Lark allows it or you're on same domain)
//Â  Â 2. Via a simple CORS proxy you can self-host (see bottom of file)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function getToken() {
Â  if (token && Date.now() < tokenExp - 60000) return token;

Â  // Try direct first (works in Lark mini-apps / same origin)
Â  try {
Â  Â  const res = await fetch('https://open.larksuite.com/open-apis/auth/v3/tenant_access_token/internal', {
Â  Â  Â  method: 'POST',
Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  body: JSON.stringify({ app_id: cfg.appId, app_secret: cfg.appSecret })
Â  Â  });
Â  Â  const data = await res.json();
Â  Â  if (data.code === 0) {
Â  Â  Â  token = data.tenant_access_token;
Â  Â  Â  tokenExp = Date.now() + (data.expire * 1000);
Â  Â  Â  return token;
Â  Â  }
Â  Â  throw new Error(data.msg);
Â  } catch(e) {
Â  Â  // CORS blocked â€” try proxy
Â  Â  const proxyUrl = localStorage.getItem('ubest_proxy') || '';
Â  Â  if (proxyUrl) {
Â  Â  Â  const res = await fetch(proxyUrl + '/token', {
Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  Â  body: JSON.stringify({ app_id: cfg.appId, app_secret: cfg.appSecret })
Â  Â  Â  });
Â  Â  Â  const data = await res.json();
Â  Â  Â  if (data.tenant_access_token) {
Â  Â  Â  Â  token = data.tenant_access_token;
Â  Â  Â  Â  tokenExp = Date.now() + (data.expire * 1000);
Â  Â  Â  Â  return token;
Â  Â  Â  }
Â  Â  }
Â  Â  throw new Error('Auth failed â€” CORS blocked. See setup notes.');
Â  }
}

async function connectLark() {
Â  const btn = document.getElementById('connectBtn');
Â  const spin = document.getElementById('connectSpin');
Â  const label = document.getElementById('connectLabel');
Â  const banner = document.getElementById('setupBanner');

Â  if (!document.getElementById('s_appToken').value.trim()) {
Â  Â  banner.className = 'conn-banner err';
Â  Â  banner.textContent = 'âš  App Token is required â€” get it from your Base URL';
Â  Â  return;
Â  }
Â  if (!document.getElementById('s_tableId').value.trim()) {
Â  Â  banner.className = 'conn-banner err';
Â  Â  banner.textContent = 'âš  Table ID is required â€” get it from your Base URL';
Â  Â  return;
Â  }

Â  btn.disabled = true;
Â  label.style.display = 'none';
Â  spin.style.display = 'block';
Â  banner.className = 'conn-banner';
Â  banner.textContent = '';

Â  saveCfg();
Â  token = null; // force refresh

Â  try {
Â  Â  await getToken();
Â  Â  banner.className = 'conn-banner ok';
Â  Â  banner.textContent = 'âœ… Connected successfully!';
Â  Â  setStatus('connected', 'CONNECTED');
Â  Â  setTimeout(() => {
Â  Â  Â  document.getElementById('setupOverlay').classList.remove('show');
Â  Â  Â  document.getElementById('barcodeIn').focus();
Â  Â  }, 800);
Â  } catch(e) {
Â  Â  banner.className = 'conn-banner err';
Â  Â  banner.textContent = 'âŒ ' + e.message + ' â€” Check your App ID & Secret';
Â  Â  setStatus('error', 'AUTH FAILED');
Â  } finally {
Â  Â  btn.disabled = false;
Â  Â  label.style.display = '';
Â  Â  spin.style.display = 'none';
Â  }
}

function setStatus(type, text) {
Â  const pill = document.getElementById('statusPill');
Â  const txtÂ  = document.getElementById('statusText');
Â  pill.className = 'status-pill ' + (type === 'connected' ? 'connected' : type === 'error' ? 'error' : '');
Â  txt.textContent = text;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//Â  ITEMS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addItem() {
Â  const el = document.getElementById('barcodeIn');
Â  const barcode = el.value.trim();
Â  const qty = Math.max(1, parseInt(document.getElementById('qtyIn').value) || 1);
Â  if (!barcode) { toast('Enter a barcode first', 'err'); el.focus(); return; }

Â  const ex = items.find(i => i.barcode === barcode);
Â  if (ex) {
Â  Â  ex.qty += qty;
Â  Â  ex.merged = true;
Â  Â  toast(`Merged â€” ${barcode} â†’ qty now ${ex.qty}`, 'wrn');
Â  } else {
Â  Â  items.push({ id: Date.now(), barcode, qty, merged: false });
Â  Â  toast(`Added: ${barcode}`, 'ok');
Â  }

Â  el.value = '';
Â  document.getElementById('qtyIn').value = 1;
Â  el.focus();

Â  document.getElementById('scanCard').classList.add('scanning');
Â  setTimeout(() => document.getElementById('scanCard').classList.remove('scanning'), 600);

Â  render();
}

function removeItem(id) {
Â  items = items.filter(i => i.id !== id);
Â  render();
}

function chQty(id, d) {
Â  const it = items.find(i => i.id === id);
Â  if (it) { it.qty = Math.max(1, it.qty + d); render(); }
}

function clearAll() {
Â  if (!items.length) return;
Â  if (!confirm(`Clear all ${items.length} item${items.length>1?'s':''}?`)) return;
Â  items = [];
Â  render();
Â  toast('Cleared', 'inf');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//Â  RENDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function render() {
Â  const listÂ  Â  = document.getElementById('itemList');
Â  const emptyÂ  Â = document.getElementById('emptyState');
Â  const summary = document.getElementById('summary');
Â  const subBtnÂ  = document.getElementById('submitBtn');
Â  const badgeÂ  Â = document.getElementById('countBadge');

Â  badge.textContent = `${items.length} item${items.length!==1?'s':''}`;

Â  if (!items.length) {
Â  Â  list.style.display = 'none';
Â  Â  empty.style.display = 'block';
Â  Â  summary.style.display = 'none';
Â  Â  subBtn.disabled = true;
Â  Â  return;
Â  }

Â  empty.style.display = 'none';
Â  list.style.display = 'flex';
Â  summary.style.display = 'flex';
Â  subBtn.disabled = false;

Â  const tQtyÂ  = items.reduce((s,i) => s+i.qty, 0);
Â  const uSkus = new Set(items.map(i => i.barcode)).size;
Â  document.getElementById('sumItems').textContent = items.length;
Â  document.getElementById('sumQty').textContentÂ  Â = tQty;
Â  document.getElementById('sumUniq').textContentÂ  = uSkus;

Â  list.innerHTML = items.map((it, idx) => `
Â  Â  <div class="item${it.merged?' merged':''}" id="row-${it.id}">
Â  Â  Â  <span class="item-num">${idx+1}</span>
Â  Â  Â  <span class="item-bar">${esc(it.barcode)}</span>
Â  Â  Â  ${it.merged ? '<span class="merged-tag">+MERGED</span>' : ''}
Â  Â  Â  <div class="qty-ctrl">
Â  Â  Â  Â  <button class="qb" onclick="chQty(${it.id},-1)">âˆ’</button>
Â  Â  Â  Â  <span class="item-qty">${it.qty}</span>
Â  Â  Â  Â  <button class="qb" onclick="chQty(${it.id},1)">+</button>
Â  Â  Â  </div>
Â  Â  Â  <button class="del-btn" onclick="removeItem(${it.id})" title="Remove">âœ•</button>
Â  Â  </div>
Â  `).join('');
}

function esc(s) {
Â  return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//Â  SUBMIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function submitAll() {
Â  if (!items.length) return;
Â  if (!cfg.appToken || !cfg.tableId) {
Â  Â  toast('Configure Base connection first', 'err');
Â  Â  showSetup(); return;
Â  }

Â  const branchÂ  Â = document.getElementById('branchSel').value;
Â  const supplier = document.getElementById('supplierSel').value;

Â  const btn = document.getElementById('submitBtn');
Â  btn.classList.add('loading');
Â  btn.disabled = true;
Â  setStatus('connected', 'SUBMITTINGâ€¦');

Â  try {
Â  Â  const tok = await getToken();

Â  Â  const records = items.map(it => ({
Â  Â  Â  fields: {
Â  Â  Â  Â  [cfg.barcodeF]: it.barcode,
Â  Â  Â  Â  [cfg.qtyF]: it.qty,
Â  Â  Â  Â  ...(branchÂ  Â ? {[cfg.branchF]:Â  Â branch}Â  Â : {}),
Â  Â  Â  Â  ...(supplier ? {[cfg.supplierF]: supplier} : {})
Â  Â  Â  }
Â  Â  }));

Â  Â  // Chunk into batches of 500 (Lark limit)
Â  Â  let created = 0;
Â  Â  for (let i = 0; i < records.length; i += 500) {
Â  Â  Â  const chunk = records.slice(i, i+500);
Â  Â  Â  const res = await fetch(
Â  Â  Â  Â  `https://open.larksuite.com/open-apis/bitable/v1/apps/${cfg.appToken}/tables/${cfg.tableId}/records/batch_create`,
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  headers: {
Â  Â  Â  Â  Â  Â  'Content-Type': 'application/json',
Â  Â  Â  Â  Â  Â  'Authorization': `Bearer ${tok}`
Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  body: JSON.stringify({ records: chunk })
Â  Â  Â  Â  }
Â  Â  Â  );
Â  Â  Â  const data = await res.json();
Â  Â  Â  if (data.code !== 0) throw new Error(data.msg || `API error code ${data.code}`);
Â  Â  Â  created += data.data?.records?.length || chunk.length;
Â  Â  }

Â  Â  toast(`âœ… ${created} record${created!==1?'s':''} added to Lark Base!`, 'ok');
Â  Â  setStatus('connected', 'CONNECTED');
Â  Â  items = [];
Â  Â  render();

Â  } catch(e) {
Â  Â  toast('âŒ ' + e.message, 'err');
Â  Â  setStatus('error', 'SUBMIT FAILED');
Â  Â  console.error(e);
Â  } finally {
Â  Â  btn.classList.remove('loading');
Â  Â  btn.disabled = items.length === 0;
Â  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//Â  CAMERA SCANNING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function openCam() {
Â  if (!('BarcodeDetector' in window)) {
Â  Â  toast('Camera scanning needs Chrome on Android or Desktop Chrome 88+', 'err');
Â  Â  return;
Â  }
Â  try {
Â  Â  camStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode:'environment' } });
Â  Â  document.getElementById('vid').srcObject = camStream;
Â  Â  document.getElementById('camSection').classList.add('show');
Â  Â  document.getElementById('camOpenBtn').style.display = 'none';

Â  Â  const det = new BarcodeDetector({ formats:['qr_code','code_128','ean_13','ean_8','code_39','upc_a','upc_e','code_93'] });
Â  Â  let last = '', lastT = 0;
Â  Â  camTimer = setInterval(async () => {
Â  Â  Â  const vid = document.getElementById('vid');
Â  Â  Â  if (vid.readyState !== vid.HAVE_ENOUGH_DATA) return;
Â  Â  Â  try {
Â  Â  Â  Â  const bcs = await det.detect(vid);
Â  Â  Â  Â  if (bcs.length) {
Â  Â  Â  Â  Â  const v = bcs[0].rawValue, now = Date.now();
Â  Â  Â  Â  Â  if (v !== last || now - lastT > 2500) {
Â  Â  Â  Â  Â  Â  last = v; lastT = now;
Â  Â  Â  Â  Â  Â  document.getElementById('barcodeIn').value = v;
Â  Â  Â  Â  Â  Â  addItem();
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  } catch(e){}
Â  Â  }, 400);
Â  } catch(e) {
Â  Â  toast('Camera access denied', 'err');
Â  }
}

function stopCam() {
Â  if (camStream) { camStream.getTracks().forEach(t=>t.stop()); camStream = null; }
Â  if (camTimer)Â  { clearInterval(camTimer); camTimer = null; }
Â  document.getElementById('camSection').classList.remove('show');
Â  document.getElementById('camOpenBtn').style.display = '';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//Â  TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toast(msg, type='inf') {
Â  const el = document.createElement('div');
Â  el.className = `toast ${type}`;
Â  el.textContent = msg;
Â  document.getElementById('toasts').appendChild(el);
Â  setTimeout(() => el.style.opacity = '0', 2500);
Â  setTimeout(() => el.remove(), 2800);
}
</script>

<!--
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Â  HOW TO ADD THIS INTO LARK BASE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Â  STEP 1 â€” Get your App Token & Table ID
Â  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Â  Open your Lark Base. Look at the URL:
Â  https://base.larksuite.com/base/[APP_TOKEN]/table/[TABLE_ID]
Â  Copy both values into the setup screen.

Â  STEP 2 â€” Add as Lark Mini App (Recommended)
Â  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Â  1. Go to Lark Open Platform â†’ Your App â†’ Ability â†’ Web App / Mini App
Â  2. Upload this HTML file or host it (GitHub Pages, Vercel, etc.)
Â  3. Set the URL as the Mini App home page
Â  4. Add Base permissions: bitable:app:readonly, bitable:record:write
Â  5. Publish and add to your workspace

Â  STEP 3 â€” Embed directly in Base (Dashboard widget)
Â  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Â  1. In your Base, click + to add a Dashboard view
Â  2. Add an "Embed" or "HTML" widget
Â  3. Paste the URL of where you've hosted this file

Â  CORS NOTE
Â  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Â  If you get auth errors, Lark blocks cross-origin auth calls from
Â  plain web pages. To fix this, deploy this 3-line Cloudflare Worker:

Â  // worker.js (deploy at workers.cloudflare.com â€” free tier)
Â  export default {
Â  Â  async fetch(req) {
Â  Â  Â  const body = await req.json();
Â  Â  Â  const r = await fetch('https://open.larksuite.com/open-apis/auth/v3/tenant_access_token/internal', {
Â  Â  Â  Â  method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(body)
Â  Â  Â  });
Â  Â  Â  const data = await r.json();
Â  Â  Â  return new Response(JSON.stringify(data), {
Â  Â  Â  Â  headers:{ 'Content-Type':'application/json', 'Access-Control-Allow-Origin':'*' }
Â  Â  Â  });
Â  Â  }
Â  }

Â  Then in browser console run:
Â  localStorage.setItem('ubest_proxy', 'https://your-worker.workers.dev')

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-->
</body>
</html>
